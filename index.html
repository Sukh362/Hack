<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ParentGuard Mic Panel</title>
<style>
    body { font-family: Arial; background: #f0f0f0; padding: 20px; }
    h2 { color: #333; }
    button { padding: 10px 20px; margin: 5px; font-size: 16px; }
    #status { margin-top: 10px; }
    audio { display: block; margin-top: 10px; }
</style>
</head>
<body>

<h2>ParentGuard Child - Microphone Panel</h2>
<button onclick="fetchAudio()">Fetch & Play Audio</button>
<div id="status"></div>
<audio id="childAudio" controls></audio>

<script>
var FIREBASE_URL = "https://parent-guard-53b4a-default-rtdb.firebaseio.com/child1/mic_record.json";

function fetchAudio() {
    document.getElementById("status").innerText = "Fetching audio...";
    fetch(FIREBASE_URL)
        .then(response => response.json())
        .then(data => {
            if(data && data.audio){
                var binary = atob(data.audio.replace(/\n/g, ''));
                var len = binary.length;
                var buffer = new Uint8Array(len);
                for (var i = 0; i < len; i++) {
                    buffer[i] = binary.charCodeAt(i);
                }
                var blob = new Blob([buffer], {type: 'audio/3gp'});
                var audio = document.getElementById("childAudio");
                audio.src = URL.createObjectURL(blob);
                audio.play();
                document.getElementById("status").innerText = "Playing audio recorded at: " + data.time;
            } else {
                document.getElementById("status").innerText = "No audio found yet!";
            }
        })
        .catch(err => {
            console.error(err);
            document.getElementById("status").innerText = "Error fetching audio!";
        });
}
</script>

</body>
</html>
