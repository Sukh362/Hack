<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro Admin Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Roboto',sans-serif;}
body{background:#0f0f1f;color:#fff;display:flex;height:100vh;overflow:hidden;}

/* Sidebar */
.sidebar{width:250px;background:#1a1a2e;display:flex;flex-direction:column;transition:0.3s;}
.sidebar.collapsed{width:70px;}
.sidebar h2{text-align:center;padding:20px 0;color:#00e0ff;font-size:22px;}
.sidebar a{display:flex;align-items:center;color:#fff;text-decoration:none;padding:15px 20px;margin:5px 10px;border-radius:8px;transition:0.3s;}
.sidebar a i{margin-right:15px;}
.sidebar a:hover{background:#00e0ff33;color:#00e0ff;}

/* Main content */
.main{flex:1;display:flex;flex-direction:column;}
.topbar{background:#1f1f2e;padding:15px 30px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 4px 12px rgba(0,0,0,0.5);}
.topbar h1{color:#00e0ff;font-size:24px;}
.toggle-btn{font-size:20px;cursor:pointer;color:#fff;}

.dashboard{padding:20px;overflow-y:auto;flex:1;}
.cards{display:flex;gap:20px;flex-wrap:wrap;}
.card{background:linear-gradient(135deg,#1f1f2e,#2c2c44);padding:20px;border-radius:12px;flex:1;min-width:250px;transition:0.3s;box-shadow:0 8px 20px rgba(0,0,0,0.5);position:relative;}
.card i{position:absolute;top:15px;right:15px;font-size:30px;opacity:0.2;}
.card h3{font-weight:500;margin-bottom:15px;color:#00e0ff;}
.card p{font-size:26px;font-weight:700;}
.bar{width:100%;height:12px;background:#333;border-radius:6px;overflow:hidden;margin-top:10px;}
.bar-fill{height:100%;background:#00e0ff;width:0%;transition:0.5s;}

#map{width:100%;height:300px;border-radius:12px;margin-top:20px;}
.chart-container{margin-top:30px;background:#1f1f2e;padding:20px;border-radius:12px;}

.footer{padding:20px;text-align:center;color:#888;font-size:14px;}
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <h2>Child Panel</h2>
  <a href="#"><i class="fas fa-tachometer-alt"></i><span class="text">Dashboard</span></a>
  <a href="#"><i class="fas fa-battery-half"></i><span class="text">Battery</span></a>
  <a href="#"><i class="fas fa-map-marker-alt"></i><span class="text">Location</span></a>
</div>

<div class="main">
  <div class="topbar">
    <h1>Dashboard</h1>
    <div class="toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
  </div>

  <div class="dashboard">
    <div class="cards">
      <div class="card">
        <i class="fas fa-battery-full"></i>
        <h3>Battery Level</h3>
        <p id="batteryValue">Loading...</p>
        <div class="bar"><div class="bar-fill" id="batteryBar"></div></div>
      </div>
      <div class="card">
        <i class="fas fa-map-marker-alt"></i>
        <h3>Live Location</h3>
        <p id="locationValue">Loading...</p>
      </div>
    </div>

    <div id="map"></div>

    <div class="chart-container">
      <canvas id="batteryChart"></canvas>
    </div>

    <div class="footer">Â© 2025 Your Pro Admin Panel</div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyBeNsxHh_EvN-9E7Tp3c96lU7cq0FhZNqg",
    authDomain: "https://hackapp-aff40.firebaseapp.com/__/auth/handler",
    databaseURL: "https://hackapp-aff40-default-rtdb.firebaseio.com",
    projectId: "hackapp-aff40",
    storageBucket: "hackapp-aff40.firebasestorage.app",
    messagingSenderId: "1000037921919",
    appId: "1:1000037921919:android:26df39932d4695def63b4a"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Battery
const batteryRef = ref(db, "ParentGuard/users/child1/battery");
const batteryHistory = [];
const batteryChartCtx = document.getElementById("batteryChart").getContext("2d");
const batteryChart = new Chart(batteryChartCtx, {
    type: 'line',
    data: { labels: [], datasets: [{ label:'Battery %', data:[], backgroundColor:'rgba(0,224,255,0.2)', borderColor:'#00e0ff', borderWidth:2, tension:0.3 }]},
    options:{scales:{y:{beginAtZero:true,max:100}},plugins:{legend:{labels:{color:'#00e0ff'}}}}
});

onValue(batteryRef,(snapshot)=>{
    const batteryVal = snapshot.val();
    document.getElementById("batteryValue").innerText = batteryVal+"%";
    document.getElementById("batteryBar").style.width = batteryVal+"%";
    // Update chart
    const now = new Date().toLocaleTimeString();
    batteryHistory.push({time: now, value: batteryVal});
    if(batteryHistory.length>10) batteryHistory.shift();
    batteryChart.data.labels = batteryHistory.map(x=>x.time);
    batteryChart.data.datasets[0].data = batteryHistory.map(x=>x.value);
    batteryChart.update();
});

// Location
const locationRef = ref(db, "ParentGuard/users/child1/location");
let map, marker;
function initMap(lat=28.6139,long=77.2090){
    map = new google.maps.Map(document.getElementById("map"), {center:{lat,lng:long},zoom:14});
    marker = new google.maps.Marker({position:{lat,lng:long},map});
}

onValue(locationRef,(snapshot)=>{
    const loc = snapshot.val();
    if(loc){
        document.getElementById("locationValue").innerText = "Lat: "+loc.lat+", Long: "+loc.long;
        if(marker) marker.setPosition({lat:loc.lat,lng:loc.long});
        if(map) map.setCenter({lat:loc.lat,lng:loc.long});
    }else{
        document.getElementById("locationValue").innerText = "N/A";
    }
});

// Sidebar toggle
function toggleSidebar(){ document.getElementById("sidebar").classList.toggle("collapsed"); }

</script>
<script async src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap"></script>
</body>
</html>
