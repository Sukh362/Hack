<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Child Device Monitoring Panel</title>
<style>
  body { font-family: Arial, sans-serif; background: #111; color: #fff; padding: 20px; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { padding: 10px; border: 1px solid #555; text-align: center; }
  th { background: #222; }
  #map { width: 100%; height: 400px; margin-top: 20px; border: 1px solid #555; }
</style>
</head>
<h1>HACK</h1>

<table>
  <thead>
    <tr>
      <th>Device ID</th>
      <th>Battery</th>
      <th>Location</th>
      <th>Status</th>
      <th>Last Update</th>
    </tr>
  </thead>
  <tbody id="deviceData">
    <tr><td colspan="5">Loading...</td></tr>
  </tbody>
</table>

<div id="map"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>
<script>
const DEVICE_ID = "12345";
const SERVER_URL = "https://hack-7tdp.onrender.com/api/device/" + DEVICE_ID;
let map, marker;

function initMap(lat = 0, lng = 0) {
    const loc = { lat: lat, lng: lng };
    map = new google.maps.Map(document.getElementById("map"), { zoom: 12, center: loc });
    marker = new google.maps.Marker({ position: loc, map: map });
}

async function fetchDeviceData() {
    try {
        const res = await fetch(SERVER_URL);
        if (!res.ok) throw new Error("Device not found");
        const data = await res.json();

        document.getElementById("deviceData").innerHTML = `
            <tr>
                <td>${DEVICE_ID}</td>
                <td>${data.battery}</td>
                <td>${data.location}</td>
                <td>${data.status}</td>
                <td>${new Date(data.lastUpdate).toLocaleString()}</td>
            </tr>
        `;

        // Update map
        if (data.location && data.location !== "Not fetched") {
            const [lat, lng] = data.location.split(",").map(Number);
            const loc = { lat: lat, lng: lng };
            if (!map) initMap(lat, lng);
            marker.setPosition(loc);
            map.setCenter(loc);
        }
    } catch (err) {
        document.getElementById("deviceData").innerHTML = `<tr><td colspan="5">Error fetching data</td></tr>`;
        console.error(err);
    }
}

// Fetch data every 2 seconds
fetchDeviceData();
setInterval(fetchDeviceData, 2000);
</script>

</body>
</html>
